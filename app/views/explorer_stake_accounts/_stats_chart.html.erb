<canvas id="<%= local_assigns[:chart_name] %>"></canvas>
<script type="text/javascript">
    var ctx = document.getElementById("<%= local_assigns[:chart_name] %>").getContext('2d');
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: <%= local_assigns[:epochs] %>,
            datasets: [
                {
                    label: ' Active Stake  ',
                    fill: false,
                    borderColor: "<%= SPARK_LINE_1 %>",
                    backgroundColor: "<%= SPARK_LINE_1 %>",
                    borderWidth: 1,
                    radius: 0,
                    data: <%= local_assigns[:active_stake_vector] %>,
                    tension: 0,
                    yAxisID: 'y'
                },
                {
                    label: ' Average Active Stake',
                    fill: false,
                    borderColor: "<%= SPARK_LINE_2 %>",
                    backgroundColor: "<%= SPARK_LINE_2 %>",
                    borderWidth: 1,
                    radius: 0,
                    data: <%= local_assigns[:average_active_stake] %>,
                    tension: 0,
                    yAxisID: 'y1'
                }
            ]
        },

        options: {
          scales: {
            x: {
              display: true,
              ticks: {
                display: true,
                minRotation: 0,
                maxRotation: 0,
                autoSkip: true,
                autoSkipPadding: 30
              },
              grid: { display: false },
              title: {
                display: true,
                text: "Last <%= local_assigns[:epochs].count %> Epochs",
                color: "<%= DARK_GREY %>"
              }
            },
            y: {
              display: true,
              ticks: {
                min: 0,
                padding: 5
              },
              grid: {
                display: true,
                color: "<%= LIGHT_GREY_TRANSPARENT %>"
              },
              title: {
                display: true,
                text: "Active Stake SOL",
                color: "<%= DARK_GREY %>"
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              grid: {
                drawOnChartArea: false, // only want the grid lines for one axis to show up
              },
              title: {
                display: true,
                text: "Avg Active Stake SOL",
                color: "<%= DARK_GREY %>"
              }
            }
          },
          interaction: {
            intersect: false,
            mode: 'index',
          },
          plugins: {
            tooltip: {
              enabled: true,
              displayColors: false,
              padding: 8,
              callbacks: {
                label: function(tooltipItem) {
                  if (tooltipItem.datasetIndex == 0) {
                    return "Active stake: " + tooltipItem.raw.toLocaleString('en-US') + " SOL";
                  } else {
                    return "Average active stake: " + tooltipItem.raw.toLocaleString('en-US') + " SOL";
                  }
                },
                title: function(tooltipItem) {
                  return  "Epoch " + tooltipItem[0].label;
                },
              }
            },
            legend: {
              labels: {
                boxWidth: 8,
                boxHeight: 8,
                usePointStyle: true,
                padding: 5,
                color: "<%= DARK_GREY %>",
                font: {
                  size: 14
                }
              },
            },
          }
        },
        plugins: [{
          beforeInit(chart) {
            const originalFit = chart.legend.fit;
            chart.legend.fit = function fit() {
              originalFit.bind(chart.legend)();
              this.height += 12;
            }
          },
        }]
      });
</script>
