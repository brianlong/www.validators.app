# frozen_string_literal: true

require File.expand_path('../config/environment', __dir__)

DOUBLEZERO_IPS = [
  "160.202.131.117", "195.12.227.249", "35.159.195.72", "189.1.171.173", "45.77.142.108", "64.130.32.77", "185.92.120.151", "67.213.113.103", "81.16.188.250", "86.111.48.190",
  "217.170.192.166", "85.195.100.119", "147.28.165.79", "149.50.116.145", "46.17.103.70", "188.214.130.71", "65.20.100.233", "57.128.64.53", "93.115.25.190", "66.206.2.170",
  "188.214.130.97", "88.216.197.27", "89.111.15.150", "70.34.211.174", "31.172.68.190", "57.129.87.228", "45.139.132.87", "64.130.32.60", "3.71.46.3", "23.109.62.84",
  "3.65.206.72", "5.255.78.21", "64.130.42.123", "64.130.32.133", "198.244.165.235", "64.130.52.201", "64.130.52.135", "64.130.52.205", "213.163.64.140", "209.38.103.172",
  "136.244.108.105", "194.126.172.174", "194.126.172.242", "89.42.231.199", "84.32.186.77", "64.130.55.254", "64.130.62.38", "74.118.136.173", "208.91.107.71", "52.194.235.230",
  "202.8.9.28", "64.130.49.181", "8.244.152.28", "45.250.255.163", "64.130.49.67", "64.130.49.117", "109.94.99.139", "64.130.49.180", "207.121.26.12", "67.213.120.9",
  "69.67.151.19", "88.216.198.169", "208.91.110.197", "149.28.34.6", "177.54.159.47", "103.106.59.199", "185.209.178.37", "172.19.1.33", "45.63.111.115", "66.165.246.46",
  "185.209.178.161", "173.231.41.194", "66.45.251.114", "173.214.163.54", "149.28.38.64", "195.12.228.194", "144.168.36.130", "104.237.53.202", "149.28.255.82", "69.67.149.97",
  "64.130.58.6", "192.69.209.194", "38.97.60.51", "54.215.102.227", "38.129.137.238", "23.92.79.26", "65.19.161.132", "72.46.85.217", "140.82.20.6", "88.211.249.212",
  "103.50.32.128", "37.122.252.22", "65.20.105.212", "72.46.84.221", "67.209.52.136", "109.94.97.111", "64.130.63.76", "18.132.203.9", "177.54.154.15", "15.235.228.93",
  "72.46.87.231", "67.213.122.45", "177.54.154.235", "67.213.122.59", "202.8.11.195", "13.214.217.82", "8.245.23.252", "8.245.26.220"
]

logger = Logger.new('log/update_doublezero_validators.log')
logger.info("Updating DoubleZero validators...")

doublezero_validators_ids = []

begin
  DOUBLEZERO_IPS.each do |ip_address|
    ValidatorIp.where(is_active: true, address: ip_address).find_each do |validator_ip|
      next unless validator_ip.validator_id.present?

      doublezero_validators_ids << validator_ip.validator_id
    end
  end

  Validator.where.not(id: doublezero_validators_ids).update_all(is_dz: false)
  Validator.where(id: doublezero_validators_ids).update_all(is_dz: true)

  logger.info("DoubleZero validators updated successfully: #{doublezero_validators_ids}")
rescue StandardError => e
  logger.error("Failed to update DoubleZero validators: #{e}")
  Appsignal.send_error(e)
end
