# frozen_string_literal: true

require File.expand_path('../config/environment', __dir__)

DOUBLEZERO_IPS = [
  "160.202.131.117", "195.12.227.249", "35.159.195.72", "189.1.171.173", "37.114.51.4", "64.130.32.77", "64.130.40.157", "67.213.113.103",
  "195.231.30.71", "86.111.48.190", "217.170.192.166", "45.139.132.156", "45.139.132.204", "45.139.132.171", "64.130.32.213", "46.17.103.70",
  "64.130.57.142", "45.77.142.108", "185.171.202.78", "185.92.120.151", "217.170.192.106", "91.209.71.13", "109.202.206.58", "45.158.38.50",
  "102.211.135.167", "45.158.38.30", "64.130.57.216", "149.50.108.223", "147.28.171.13", "149.50.116.145", "45.139.132.107", "188.214.130.71",
  "65.20.100.233", "45.139.132.64", "93.115.25.190", "66.206.2.170", "188.214.130.97", "88.216.197.27", "89.111.15.150", "70.34.211.174",
  "31.172.68.190", "57.129.87.228", "45.139.132.87", "45.139.132.84", "64.130.32.60", "3.71.46.3", "185.221.164.109", "189.1.171.175",
  "189.1.171.177", "185.26.10.239", "67.213.113.97", "185.26.10.193", "93.100.241.247", "185.189.45.221", "147.28.165.79", "80.77.161.196",
  "93.115.25.175", "93.191.10.71", "185.171.202.77", "45.139.132.116", "45.135.201.224", "45.134.108.121", "159.148.20.196", "95.214.55.25",
  "185.26.10.211", "185.26.10.229", "45.139.132.97", "85.195.104.157", "45.134.108.188", "212.83.42.92", "45.134.108.184", "45.135.201.209",
  "188.214.130.101", "45.139.132.215", "159.148.20.198", "5.199.172.187", "45.135.201.200", "88.216.197.112", "212.83.42.33", "95.67.53.214",
  "67.213.121.175", "85.195.100.119", "57.128.64.53", "212.83.43.115", "149.50.116.14", "185.177.74.54", "45.152.160.116", "82.197.162.50",
  "67.213.113.105", "67.213.113.99", "103.219.171.217", "160.202.131.189", "185.26.10.233", "185.167.205.3", "3.65.206.72", "5.255.78.21",
  "64.130.42.123", "64.130.32.133", "198.244.165.235", "64.130.52.201", "64.130.52.135", "64.130.52.205", "213.163.64.140", "209.38.103.172",
  "136.244.108.105", "194.126.172.174", "194.126.172.242", "89.42.231.199", "84.32.186.77", "64.130.55.254", "209.250.244.17", "74.118.136.173",
  "23.109.62.84", "194.126.172.170", "89.42.231.104", "147.75.84.157", "5.39.216.186", "202.8.8.21", "64.130.52.111", "89.42.231.167",
  "89.42.231.135", "84.32.186.112", "194.126.172.210", "84.32.186.110", "64.130.43.202", "149.255.37.170", "94.142.240.72", "178.239.19.42",
  "67.213.127.33", "208.91.107.71", "52.194.235.230", "202.8.9.28", "8.244.152.28", "64.130.49.67", "64.130.49.117", "109.94.99.139",
  "207.121.26.12", "185.26.9.17", "69.67.151.19", "88.216.198.169", "208.91.110.197", "149.28.34.6", "177.54.159.47", "103.106.59.199",
  "67.213.120.9", "172.19.1.33", "45.63.111.115", "66.165.246.46", "185.209.178.161", "173.231.41.194", "66.45.251.114", "64.130.37.3",
  "149.28.38.64", "67.213.120.195", "74.50.79.146", "208.91.110.214", "64.130.34.46", "177.54.155.191", "185.26.8.37", "69.10.46.70",
  "35.212.25.53", "64.20.53.122", "149.248.51.171", "173.201.36.4", "23.227.189.30", "185.8.106.250", "84.32.32.19", "104.243.33.35",
  "107.155.98.198", "207.246.84.247", "162.250.124.6", "154.16.171.107", "84.32.32.86", "195.12.228.194", "185.32.162.192", "144.168.36.130",
  "104.237.53.202", "149.28.255.82", "69.67.149.97", "64.130.58.6", "192.69.209.194", "38.97.60.51", "54.215.102.227", "38.129.137.238",
  "23.92.79.26", "65.19.161.132", "72.46.85.217", "140.82.20.6", "104.237.51.122", "38.46.223.227", "103.88.234.129", "103.88.234.127",
  "45.76.239.188", "69.67.148.121", "15.204.108.105", "46.21.152.10", "108.171.217.186", "107.155.109.202", "38.92.24.104", "107.155.92.114",
  "216.238.67.40", "104.238.221.184", "192.69.209.186", "103.88.234.123", "88.211.249.212", "103.50.32.128", "37.122.252.22", "65.20.105.212",
  "72.46.84.221", "193.221.135.102", "109.94.97.111", "64.130.63.76", "18.132.203.9", "109.94.97.181", "109.94.97.183", "72.46.84.117",
  "103.50.32.193", "77.81.119.214", "185.26.11.167", "185.26.11.195", "185.26.11.139", "72.46.84.217", "77.81.119.154", "139.84.228.251",
  "91.237.141.224", "198.244.253.205", "67.213.117.59", "72.46.84.121", "177.54.154.15", "15.235.228.93", "72.46.87.231", "67.213.122.45",
  "177.54.154.235", "67.213.122.59", "202.8.11.195", "13.214.217.82", "8.245.23.252", "8.245.26.220", "5.199.164.218", "72.46.87.247",
  "103.28.89.181"

]

logger = Logger.new('log/update_doublezero_validators.log')
logger.info("Updating DoubleZero validators...")

doublezero_validators_ids = []

begin
  DOUBLEZERO_IPS.each do |ip_address|
    ValidatorIp.where(is_active: true, address: ip_address).find_each do |validator_ip|
      next unless validator_ip.validator_id.present?

      doublezero_validators_ids << validator_ip.validator_id
    end
  end

  Validator.where.not(id: doublezero_validators_ids).update_all(is_dz: false)
  Validator.where(id: doublezero_validators_ids).update_all(is_dz: true)

  logger.info("DoubleZero validators updated successfully: #{doublezero_validators_ids}")
rescue StandardError => e
  logger.error("Failed to update DoubleZero validators: #{e}")
  Appsignal.send_error(e)
end
